---
layout: page
title: Syndicated Applications
language: en
---

A syndicated application is an application that is directly erogated by the software vendor, and not hosted on the ClouDesire platform itself.

This feature enables software vendors to sell their applications that are already hosted somewhere and that usually has native support for multi-tenantancy.
They should be able to provision a new tenant almost instantaneously, and the integration is done via REST API.

The ClouDesire platform in this case is used only for the marketplace/billing features and not for the operations, which are directly managed by the software vendor.

To achieve this, the platform will send REST requests to a vendor-specified endpoint for the most interesting events generated by users on the marketplace (new subscription created, customer information changed and so on).
The software vendor should receive this notification and behave accordingly, and finally update the subscription status via API.

## Syndication Endpoint

When creating a new product that should be delivered in syndication mode, you should specify and http(s) endpoint where the platform events will be pushed by the platform, whenever they occurs.

## Events

The events sent to the vendor endpoint contains a JSON payload and will look like:

{% highlight http %}
POST /endpoint HTTP/1.1
Accept: application/json
Content-Length: 89
Content-Type: application/json; charset=utf-8
Host: vendor.example.org
User-Agent: ClouDesire

{
  "date": "2015-01-12T11:19:30Z",
  "entity": "Subscription",
  "id": "18",
  "type": "CREATED"
}
{% endhighlight %}

The ```type``` attribute can be: ```CREATED```, ```MODIFIED```, ```DELETED```.

Events are currently sent only for the resource Subscription, but we will add more in the future.

### Received event handling

The platform expect that you reply with a ```204 - No content``` response (empty response body).

If the response contains a non-2xx status code, that platform will retry to send the event later, until the endpoint will return a non-2xx status code.

## Standard workflow after subscription creation

Once a new subscription event is received, you probably want to have more information about such subscription, and at this point you just need to use the standard [ClouDesire API](/en/api.html).

### Retrieve subscription information

Start with fetching the subscription object:

{% highlight http %}
GET /api/subscription/18 HTTP/1.1
{% endhighlight %}

An example reply would be:

{% highlight http %}
HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 13 Jan 2015 15:05:52 GMT

{
  "billingPeriod": 0,
  "buildingBlockInstance": {
    "url": "buildingBlockInstance/2395"
  },
  "deploymentStatus": "PENDING",
  "endDate": "2014-05-14T11:28:44Z",
  "id": 2388,
  "invoices": [
    {
      "url": "invoice/2390"
    }
  ],
  "orders": [
    {
      "url": "order/2389"
    }
  ],
  "renewable": true,
  "self": "subscription/2388",
  "syndicatedEndpoints": [],
  "type": "NORMAL"
}
{% endhighlight %}

You may notice that the deploymentStatus is ```PENDING```, meaning that this subscription is not yet available to the customer.

### Retrieve selling information

Next step is to fetch the associated resource ```order/2389```, containing all the references of the customer transaction:

{% highlight http %}
GET /api/order/2389 HTTP/1.1
{% endhighlight %}

{% highlight http %}
HTTP/1.1 200 OK
Content-Type: application/json

{
  "budget": {
    "configuration": {
      "url": "productVersion/230"
    },
    "endOfPeriod": "2013-12-08T00:00:00Z",
    "lines": [...],
    "nation": "IT",
    "totalPrice": 74.42
  },
  "buyer": {
    "url": "user/2240"
  },
  "currency": "EUR",
  "date": "2015-11-08T15:29:44Z",
  "id": 2389,
  "self": "order/2389",
  "state": "VENDOR_APPROVED",
  "subscription": {
    "url": "subscription/2388"
  },
  "totalPrice": 74.42,
  "type": "NORMAL"
}
{% endhighlight %}

In the order you can find who bought your product ```user/2240``` and  which specific version ```productVersion/230```.

### Retrieve customer information

Once we got the customer reference in the order resource, you can fetch the customer information:

{% highlight http %}
GET /api/user/2240 HTTP/1.1
{% endhighlight %}

{% highlight http %}
HTTP/1.1 200 OK
Content-Type: application/json

{
  "acceptedTerms": true,
  "activated": true,
  "activationDate": "2014-01-01T00:00:00Z",
  "address": {
    "address": "Via Napoli",
    "city": "Pisa",
    "country": "IT",
    "id": 2241,
    "zipCode": "12345"
    },
    "creationDate": "2014-07-02T08:20:01Z",
    "email": "customer@example.org",
    "enabled": true,
    "environment": "cloudesire",
    "id": 2240,
    "name": "Demo Customer",
    "phoneNumber": "123891237912",
    "self": "user/2240",
    "userName": "customer",
    "userRole": "ROLE_USER"
}
{% endhighlight %}

At this point you may have everything you need to activate your new tenant, but feel free to browse around resources, you may take a peek on the [API reference](http://api.cloudesire.com) for a brief description of each one.

### Update subscription information

After having activated the new tenant, you just need to notify the platform that the customer may use the application, activating the subscription and entering information on how to reach the application.

Send the request ```PATCH subscription/18``` to alter the subscription attributes:

{% highlight http %}
PATCH /api/subscription/18 HTTP/1.1
Content-Type: application/json; charset=utf-8

{
  "deploymentStatus": "DEPLOYED",
  "syndicatedEndpoints": [ "http://vendor.example.org" ]
  "endUserIstructions": "Use your email as login and password jei9je9y"
}
{% endhighlight %}

If the response is succesfull, the subscription have been started and the customer will find this information on his control panel and will start to use the application.
